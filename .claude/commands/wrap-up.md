---
allowed-tools: Bash(gh pr:*), Bash(git log:*), Bash(git remote:*), Bash(gh api:*), Read, Grep, Glob
description: PR 요약 코멘트 -- 이 PR이 어떤 문제를 어떻게 해결했는지, 핵심 결정사항을 정리하여 PR에 코멘트로 게시
---

# /wrap-up -- PR Decision Summary

Analyze the current PR and post a comment summarizing:
1. What problem this PR solves and how
2. What key decisions the human made during the process

## Step 1: Verify PR Exists

Run:
```bash
gh pr view --json number,url,title,body,headRefName,baseRefName
```

If fails, exit:
> No PR found on the current branch. Create a PR first.

Extract `PR_NUMBER`, `PR_URL`, `PR_TITLE`, `PR_BODY`, `BASE_REF`.

## Step 2: Gather Context

Run these in parallel:
```bash
gh pr diff --stat
git log {BASE_REF}..HEAD --pretty=format:"%h %s" --reverse
git log {BASE_REF}..HEAD --pretty=format:"%h%n%B---" --reverse
gh pr diff
git remote get-url origin
```

Store:
- `DIFF_STAT` -- file change summary
- `COMMIT_LOG` -- one-line commit history
- `COMMIT_DETAILS` -- full commit messages
- `FULL_DIFF` -- complete diff
- `OWNER_REPO` -- parsed from remote URL (handle HTTPS and SSH)

## Step 3: Analyze the Session Conversation

You have access to the current conversation history. Review it carefully.

### 3a. Problem and Solution
- What triggered this work? (issue, bug, feature request, refactoring)
- What was the core technical challenge?
- What approach was taken?
- What are the key conceptual changes? (not a file list)

### 3b. Human Decisions (Human-in-the-Loop)
Scan the conversation for moments where the human:
- **Chose between alternatives** -- "Use A instead of B"
- **Rejected a suggestion** -- "No, don't do that because..."
- **Added constraints** -- "It must work with X", "Don't change Y"
- **Made design calls** -- naming, architecture, scope
- **Scoped the work** -- "Only do X for now", "Skip Y"
- **Corrected course** -- "Actually, change direction to..."

Focus on decisions that shaped the outcome. Ignore trivial approvals.

## Step 4: Write the Comment

Compose in Korean:

```markdown
## PR Wrap-up

### 이 PR은 어떤 문제를 어떻게 해결하는가?

**문제**: {1-3 sentences describing the problem/motivation}

**해결 방법**: {2-5 sentences describing the approach and key changes. Be specific about WHAT changed and WHY.}

### 핵심 결정사항 (Human-in-the-Loop)

{List only important decisions. Each explains WHAT was decided and WHY.}

- **{decision_topic}**: {what was decided} -- {why / what was the alternative}
- ...

---
*Generated by `/wrap-up`*
```

Guidelines:
- Write in Korean
- Be concise -- summary, not documentation
- Problem/solution: focus on "why" and "how", not file lists
- Decisions: only meaningful ones that shaped the outcome. 3-7 entries typical.
- If no meaningful decisions found: "이 PR은 초기 계획대로 별도의 방향 변경 없이 구현되었습니다."

## Step 5: Post the Comment

```bash
gh api repos/{OWNER_REPO}/issues/{PR_NUMBER}/comments \
  -f body='{COMMENT_BODY}'
```

If posting fails, print the comment body to console so user can copy it manually.

## Step 6: Report

Print:
> /wrap-up complete. Comment posted on PR #{PR_NUMBER}.
> {PR_URL}
